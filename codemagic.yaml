workflows:
  default:
    name: Build APK
    max_build_duration: 60
    environment:
      vars:
        ANDROID_KEYSTORE_PATH: "$CM_KEYSTORE_PATH"
        ANDROID_KEYSTORE_PASSWORD: "$CM_KEYSTORE_PASSWORD"
        ANDROID_KEY_ALIAS: "$CM_KEY_ALIAS"
        ANDROID_KEY_PASSWORD: "$CM_KEY_PASSWORD"
    steps:
      - checkout
      - install:
          name: Install dependencies
          run: |
            curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash -
            sudo apt-get install -y nodejs
            npm install
            cd android && ./gradlew clean

      - script:
          name: Build APK
          run: |
            cd android && ./gradlew assembleRelease

      - deploy:
          name: Deploy APK
          options:
            file: "android/app/build/outputs/apk/release/app-release.apk"
